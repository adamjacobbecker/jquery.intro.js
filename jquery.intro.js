// Generated by CoffeeScript 1.3.3
(function() {
  var jQueryIntroJs;

  jQueryIntroJs = (function() {

    function jQueryIntroJs(steps) {
      this.steps = $.extend([], steps);
      this.currentStep = 0;
      if (!(this.steps.length > 0)) {
        return;
      }
      this.start();
    }

    jQueryIntroJs.prototype.start = function() {
      var _this = this;
      this.addOverlay();
      this.addHelperLayer();
      this.showCurrentStep();
      return $(document).on("keydown.introjs", function(e) {
        return _this.keydown(e);
      });
    };

    jQueryIntroJs.prototype.keydown = function(e) {
      switch (e.keyCode) {
        case 27:
          return this.endTour();
        case 37:
          return this.previousStep();
        case 39:
          return this.nextStep();
      }
    };

    jQueryIntroJs.prototype.addOverlay = function() {
      var _this = this;
      this.$overlayDiv = $("<div class='introjs-overlay'></div>");
      this.$overlayDiv.on("click", function() {
        return _this.endTour();
      });
      this.$overlayDiv.appendTo("body");
      return this.$overlayDiv.animate({
        opacity: 0.5
      }, 10);
    };

    jQueryIntroJs.prototype.addHelperLayer = function() {
      var _this = this;
      this.$helperLayerDiv = $("<div class=\"introjs-helperLayer\">\n  <span class=\"introjs-helperNumberLayer\"></span>\n  <div class=\"introjs-tooltip\">\n    <div class=\"introjs-tooltiptext\"></div>\n    <div class=\"introjs-tooltipbuttons\">\n      <a class=\"introjs-skipbutton\">Skip</a>\n      <a class=\"introjs-nextbutton\">Next â†’</a>\n    </div>\n  </div>\n</div>");
      this.$helperLayerDiv.on("click", ".introjs-nextbutton", function() {
        return _this.nextStep();
      });
      this.$helperLayerDiv.on("click", ".introjs-skipbutton", function() {
        return _this.endTour();
      });
      return this.$helperLayerDiv.appendTo("body");
    };

    jQueryIntroJs.prototype.setHelperLayer = function($el, text) {
      var $tooltipClone, height;
      this.$helperLayerDiv.css({
        width: $el.outerWidth() + 10,
        height: $el.outerHeight() + 10,
        top: $el.offset().top - 5,
        left: $el.offset().left - 5
      });
      this.$helperLayerDiv.find(".introjs-helperNumberLayer").text(this.currentStep + 1);
      this.$helperLayerDiv.find(".introjs-tooltiptext").text(text);
      this.$helperLayerDiv.find(".introjs-tooltip").css({
        opacity: 0
      });
      $tooltipClone = this.$helperLayerDiv.find(".introjs-tooltip").clone().appendTo("body").css({
        "transition": "none"
      }).css({
        "width": $el.outerWidth() + 10
      });
      height = $tooltipClone.outerHeight();
      $tooltipClone.remove();
      return this.$helperLayerDiv.find(".introjs-tooltip").css({
        opacity: 1,
        bottom: -(height + 10)
      });
    };

    jQueryIntroJs.prototype.showCurrentStep = function() {
      var $el, step,
        _this = this;
      step = this.steps[this.currentStep];
      if (typeof step['el'] === 'function') {
        $el = step['el']().slice(0, 1);
      } else {
        $el = $(step['el']).slice(0, 1);
      }
      if ($el.length === 0) {
        this.steps.splice(this.currentStep, 1);
        return this.showCurrentStep();
      }
      this.setHelperLayer($el, step['text']);
      setTimeout(function() {
        return $el.addClass('introjs-showElement');
      }, 200);
      if (!(this.steps[this.currentStep + 1] != null)) {
        return this.$helperLayerDiv.find(".introjs-nextbutton").text("Done!");
      }
    };

    jQueryIntroJs.prototype.previousStep = function() {
      return this.changeStep(-1);
    };

    jQueryIntroJs.prototype.nextStep = function() {
      return this.changeStep(1);
    };

    jQueryIntroJs.prototype.changeStep = function(delta) {
      $(".introjs-showElement").removeClass("introjs-showElement");
      if (this.steps[this.currentStep + delta] == null) {
        return this.endTour();
      }
      this.currentStep = this.currentStep + delta;
      return this.showCurrentStep();
    };

    jQueryIntroJs.prototype.endTour = function() {
      $(".introjs-showElement").removeClass("introjs-showElement");
      this.$helperLayerDiv.remove();
      this.$overlayDiv.fadeOut(100, function() {
        return $(this).remove();
      });
      return $(document).off("introjs");
    };

    return jQueryIntroJs;

  })();

  (function($) {
    return $.extend({
      intro: function(steps) {
        return new jQueryIntroJs(steps);
      }
    });
  })(jQuery);

}).call(this);
